<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catatan Keuangan Sederhana</title>
<style>
  :root{
    --bg:#f4f7fb;
    --card:#ffffff;
    --accent:#2f8f6b;
    --danger:#e15b5b;
    --muted:#70757a;
    --table-head:#f1f5f9;
  }
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#e9f3ee 0%, var(--bg) 100%);
    margin:0;
    padding:24px;
    display:flex;
    justify-content:center;
  }

  .container{
    width:980px;
    max-width:96%;
  }

  .header{
    text-align:center;
    margin-bottom:18px;
  }
  h1{ margin:6px 0; font-size:22px; }
  p.lead{ color:var(--muted); margin:0 0 12px;}

  .cards{
    display:flex;
    gap:12px;
    margin-bottom:16px;
    flex-wrap:wrap;
  }
  .card{
    background:var(--card);
    box-shadow: 0 6px 16px rgba(18,40,61,0.06);
    padding:14px;
    border-radius:10px;
    flex:1;
    min-width:200px;
  }
  .card h3{ margin:0; font-size:13px; color:var(--muted); font-weight:600;}
  .card p{ margin:6px 0 0; font-size:18px; font-weight:700; }

  .form-area{
    display:flex;
    gap:12px;
    background:var(--card);
    padding:14px;
    border-radius:10px;
    margin-bottom:12px;
    align-items:flex-end;
    flex-wrap:wrap;
  }
  label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px;}
  input[type="text"], input[type="date"], select{
    padding:8px 10px;
    border-radius:6px;
    border:1px solid #dfe6ea;
    width:220px;
    box-sizing:border-box;
  }
  input[type="number"]{ width:160px; padding:8px 10px; border-radius:6px; border:1px solid #dfe6ea;}
  .form-col{ display:flex; gap:6px; flex-direction:column; }

  .controls{ display:flex; gap:8px; flex-wrap:wrap; }
  button{
    border:0; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:600;
    box-shadow: 0 2px 6px rgba(18,40,61,0.06);
  }
  .btn-add{ background:var(--accent); color:white;}
  .btn-clear{ background:#f1f1f1; color:#333;}
  .btn-delete{ background:var(--danger); color:white;}
  .btn-export{ background:#ffbf00; color:#222; }

  .table-wrap{
    background:var(--card);
    padding:14px;
    border-radius:10px;
    box-shadow: 0 6px 16px rgba(18,40,61,0.04);
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }
  thead th{
    background:var(--table-head);
    text-align:left;
    padding:10px;
    font-size:13px;
    color:var(--muted);
    border-bottom:1px solid #edf1f3;
  }
  tbody td{ padding:10px; border-bottom:1px solid #f2f4f6; vertical-align:middle; }
  tbody tr:last-child td{ border-bottom:0; }

  .right{ text-align:right; }
  .muted{ color:var(--muted); font-size:13px; }

  .actions{ display:flex; gap:6px; }

  @media (max-width:680px){
    .form-area{flex-direction:column; align-items:stretch;}
    input[type="text"], input[type="date"], select, input[type="number"]{ width:100%;}
    .cards{flex-direction:column;}
  }

</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Catatan Keuangan</h1>
      <p class="lead">Masukkan pemasukan dan pengeluaran. Saldo akan otomatis dihitung (running balance).</p>
    </div>

    <div class="cards" id="summary">
      <div class="card">
        <h3>Total Pemasukan</h3>
        <p id="total-income">Rp 0</p>
      </div>
      <div class="card">
        <h3>Total Pengeluaran</h3>
        <p id="total-expense">Rp 0</p>
      </div>
      <div class="card">
        <h3>Saldo</h3>
        <p id="balance">Rp 0</p>
      </div>
    </div>

    <div class="form-area">
      <div class="form-col">
        <label for="date">Tanggal</label>
        <input type="date" id="date">
      </div>

      <div class="form-col">
        <label for="desc">Keterangan</label>
        <input type="text" id="desc" placeholder="Mis. Gaji, Beli bensin">
      </div>

      <div class="form-col">
        <label for="type">Tipe Transaksi</label>
        <select id="type">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
      </div>

      <div class="form-col">
        <label for="amount">Jumlah (Rp)</label>
        <input type="number" id="amount" placeholder="0" min="0" step="1">
      </div>

      <div style="display:flex; gap:8px; align-items:flex-end;" class="controls">
        <button class="btn-add" id="addBtn">Tambah</button>
        <button class="btn-clear" id="clearForm">Bersihkan</button>
        <button class="btn-export" id="downloadCSV">CSV</button>
        <button class="btn-clear" id="printBtn">PDF</button>
        <button class="btn-delete" id="clearAllBtn">Hapus Semua</button>
      </div>
    </div>

    <div class="table-wrap">
      <h3>Data Keuangan</h3>
      <table id="txTable" aria-live="polite">
        <thead>
          <tr>
            <th style="width:70px">No</th>
            <th style="width:120px">Tanggal</th>
            <th>Keterangan</th>
            <th class="right">Pemasukan (Rp)</th>
            <th class="right">Pengeluaran (Rp)</th>
            <th class="right">Saldo (Rp)</th>
            <th style="width:110px">Aksi</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- rows injected here -->
        </tbody>
      </table>
    </div>

  </div>

<script>
/*
Simple finance ledger:
- transactions stored in localStorage under key 'transactions'
- each tx: {id, date, desc, type, amount}
- render table with running balance
*/

const dateInput = document.getElementById('date');
const descInput = document.getElementById('desc');
const typeInput = document.getElementById('type');
const amountInput = document.getElementById('amount');
const addBtn = document.getElementById('addBtn');
const clearFormBtn = document.getElementById('clearForm');
const clearAllBtn = document.getElementById('clearAllBtn');
const tbody = document.getElementById('tbody');
const totalIncomeEl = document.getElementById('total-income');
const totalExpenseEl = document.getElementById('total-expense');
const balanceEl = document.getElementById('balance');
const downloadCSV = document.getElementById('downloadCSV');
const printBtn = document.getElementById('printBtn');

const STORAGE_KEY = 'transactions_v1';

/* utility */
function formatRupiah(num){
  if (isNaN(num)) num = 0;
  const neg = num < 0;
  num = Math.abs(Math.round(num));
  return (neg?'- ':'') + 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function uid() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
}

/* load/save */
function loadTx(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){ return []; }
}
function saveTx(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

/* render */
function render(){
  const tx = loadTx();
  tbody.innerHTML = '';
  let running = 0;
  let totalIncome = 0;
  let totalExpense = 0;

  tx.sort((a,b)=> (a.date > b.date) ? 1 : (a.date < b.date ? -1 : 0)); // sort by date asc

  tx.forEach((t, idx) => {
    const tr = document.createElement('tr');

    const incomeCell = t.type === 'income' ? t.amount : 0;
    const expenseCell = t.type === 'expense' ? t.amount : 0;

    totalIncome += incomeCell;
    totalExpense += expenseCell;

    running += (incomeCell - expenseCell);

    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${t.date || ''}</td>
      <td>${escapeHtml(t.desc || '')}</td>
      <td class="right">${incomeCell ? formatRupiah(incomeCell) : '-'}</td>
      <td class="right">${expenseCell ? formatRupiah(expenseCell) : '-'}</td>
      <td class="right">${formatRupiah(running)}</td>
      <td class="right">
        <div class="actions">
          <button data-id="${t.id}" class="btn-delete" onclick="deleteTx('${t.id}')">Hapus</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  totalIncomeEl.textContent = formatRupiah(totalIncome);
  totalExpenseEl.textContent = formatRupiah(totalExpense);
  balanceEl.textContent = formatRupiah(totalIncome - totalExpense);
}

/* escape to avoid simple HTML injection in desc */
function escapeHtml(unsafe){
  return (unsafe + '').replace(/[&<"'>]/g, function(m){
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];
  });
}

/* actions */
addBtn.addEventListener('click', function(){
  const date = dateInput.value || new Date().toISOString().slice(0,10);
  const desc = descInput.value.trim();
  const type = typeInput.value;
  const amount = parseInt(amountInput.value) || 0;

  if(!desc){
    alert('Tolong isi keterangan transaksi.');
    return;
  }
  if(amount <= 0){
    alert('Jumlah harus lebih dari 0.');
    return;
  }

  const tx = loadTx();
  tx.push({ id: uid(), date, desc, type, amount });
  saveTx(tx);
  render();
  clearInputs();
});

clearFormBtn.addEventListener('click', clearInputs);
function clearInputs(){
  // set date to today for convenience
  dateInput.value = new Date().toISOString().slice(0,10);
  descInput.value = '';
  typeInput.value = 'income';
  amountInput.value = '';
}

clearAllBtn.addEventListener('click', function(){
  if(confirm('Yakin ingin menghapus semua data transaksi? Tindakan ini tidak bisa dibatalkan.')){
    localStorage.removeItem(STORAGE_KEY);
    render();
  }
});

window.deleteTx = function(id){
  if(!confirm('Hapus transaksi ini?')) return;
  const tx = loadTx().filter(t => t.id !== id);
  saveTx(tx);
  render();
}

/* export CSV */
downloadCSV.addEventListener('click', function(){
  const tx = loadTx();
  if(tx.length === 0){ alert('Tidak ada data untuk diekspor.'); return; }

  // build CSV with running balance
  let csv = 'No,Tanggal,Keterangan,Pemasukan (Rp),Pengeluaran (Rp),Saldo (Rp)\\n';
  let running = 0;
  tx.sort((a,b)=>(a.date > b.date)?1:(a.date < b.date ? -1 : 0));
  tx.forEach((t, i)=>{
    const income = t.type === 'income' ? t.amount : 0;
    const expense = t.type === 'expense' ? t.amount : 0;
    running += (income - expense);
    const row = [
      i+1,
      t.date,
      '"' + t.desc.replace(/"/g,'""') + '"',
      income,
      expense,
      running
    ].join(',');
    csv += row + '\\n';
  });

  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'catatan_keuangan.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* print */
printBtn.addEventListener('click', function(){
  window.print();
});

/* initial setup */
(function init(){
  // set default date if empty
  if(!dateInput.value) dateInput.value = new Date().toISOString().slice(0,10);
  render();
})();
</script>
</body>
</html>
