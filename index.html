<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catatan Keuangan Sederhana</title>
<style>
   :root {
    --bg:#f4f7fb;
    --card:#ffffff;
    --accent:#2f8f6b;
    --danger:#e15b5b;
    --muted:#70757a;
    --table-head:#f1f5f9;
  }
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#e9f3ee 0%, var(--bg) 100%);
    margin:0;
    padding:24px;
    display:flex;
    justify-content:center;
  }

  .container{
    width:980px;
    max-width:96%;
  }

  .header{text-align:center;margin-bottom:18px;}
  h1{margin:6px 0;font-size:22px;}
  p.lead{color:var(--muted);margin:0 0 12px;}

  /* --- Cards Summary --- */
  .cards{
    display:flex;
    gap:12px;
    margin-bottom:16px;
    flex-wrap:nowrap;
    justify-content:space-between;
  }
  .card{
    background:var(--card);
    box-shadow: 0 6px 16px rgba(18,40,61,0.06);
    padding:14px;
    border-radius:10px;
    flex:1;
    min-width:0;
    text-align:center;
  }
  .card h3{margin:0;font-size:13px;color:var(--muted);font-weight:600;}
  .card p{margin:6px 0 0;font-size:18px;font-weight:700;}

  /* --- Form Area --- */
  .form-area{
    display:flex;
    gap:12px;
    background:var(--card);
    padding:14px;
    border-radius:10px;
    margin-bottom:12px;
    align-items:flex-end;
    flex-wrap:wrap;
  }
  .form-area h4 {
  text-align: center;
  width: 100%;
  margin: 4px 0 10px;   /* atas kecil (4px), bawah lebih rapat (10px) */
}

  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px;}
  input[type="text"], input[type="date"], select, input[type="number"]{
    padding:8px 10px;
    border-radius:6px;
    border:1px solid #dfe6ea;
    box-sizing:border-box;
  }
  input[type="text"],input[type="date"],select{width:220px;}
  input[type="number"]{width:160px;}
  .form-col{display:flex;gap:6px;flex-direction:column;}

  /* --- Controls --- */
  .controls{
    display:flex;
    gap:8px;
    flex-wrap:nowrap;
    justify-content:space-between;
    width:100%;
  }
  button{
    border:0;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:600;
    box-shadow: 0 2px 6px rgba(18,40,61,0.06);
    flex:1; /* supaya sejajar rapi */
  }
  .btn-add{background:var(--accent);color:white;}
  .btn-clear{background:#f1f1f1;color:#333;}
  .btn-delete{background:var(--danger);color:white;}
  .btn-export{background:#ffbf00;color:#222;}

  .table-wrap{
    background:var(--card);
    padding:14px;
    border-radius:10px;
    box-shadow: 0 6px 16px rgba(18,40,61,0.04);
    overflow-x:auto; /* ✅ biar bisa scroll di hp */
  }
  
  table{
    width:100%;
    border-collapse:collapse;
    min-width: 700px; /* ✅ supaya layout tetap rapi */
    font-size:14px;
  }
  thead th{
    background:var(--table-head);
    text-align:left;
    padding:10px 8px;
    font-size:13px;
    color:var(--muted);
    border-bottom:1px solid #edf1f3;
    white-space:nowrap;
  }
  tbody td{
    padding:10px 8px;
    border-bottom:1px solid #f2f4f6;
    vertical-align:middle;
  }
  tbody tr:last-child td{border-bottom:0;}

  /* ✅ Lebar dan alignment kolom */
  th:nth-child(1), td:nth-child(1) { width:50px; text-align:center; }
  th:nth-child(2), td:nth-child(2) { width:120px; white-space:nowrap; }
  th:nth-child(4), td:nth-child(4),
  th:nth-child(5), td:nth-child(5),
  th:nth-child(6), td:nth-child(6) {
    text-align:right;
    width:150px;
    white-space:nowrap;
  }
  th:nth-child(7), td:nth-child(7) { width:100px; text-align:center; }
  
  .right{text-align:right;}
  .actions{display:flex;gap:4px;justify-content:center;}

  /* --- Responsive untuk HP --- */
  @media (max-width:680px){
    body{padding:12px;}
    h1{font-size:18px;}

    /* Cards tetap sejajar 3 kolom */
    .cards{
      flex-wrap:nowrap;
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:8px;
    }
    .card p{font-size:16px;}

    /* Form input satu kolom, tombol sejajar */
    .form-area{flex-direction:column;align-items:stretch;}
    input[type="text"],input[type="date"],select,input[type="number"]{width:100%;}
    .controls{flex-wrap:nowrap;gap:6px;}
    .controls button{flex:1;}
  }
</style>



</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Catatan Keuangan</h1>
      <p class="lead">Masukkan pemasukan dan pengeluaran. Saldo akan otomatis dihitung (running balance).</p>
    </div>

    <div class="cards" id="summary">
      <div class="card">
        <h3>Pemasukan</h3>
        <p id="total-income">Rp 0</p>
      </div>
      <div class="card">
        <h3>Pengeluaran</h3>
        <p id="total-expense">Rp 0</p>
      </div>
      <div class="card">
        <h3>Saldo</h3>
        <p id="balance">Rp 0</p>
      </div>
    </div>

    <div class="form-area">
        <h4>Tambah Transaksi</h4>
      <div class="form-col">
        <label for="date">Tanggal</label>
        <input type="date" id="date">
      </div>

      <div class="form-col">
        <label for="desc">Keterangan</label>
        <input type="text" id="desc" placeholder="Mis. Gaji, Beli bensin">
      </div>

      <div class="form-col">
        <label for="type">Tipe Transaksi</label>
        <select id="type">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
      </div>

      <div class="form-col">
        <label for="amount">Jumlah (Rp)</label>
        <input type="number" id="amount" placeholder="0" min="0" step="1">
      </div>

      <div style="display:flex; gap:8px; align-items:flex-end;" class="controls">
        <button class="btn-add" id="addBtn">Tambah </button>
        <button class="btn-clear" id="clearForm">Bersihkan</button>
        <button class="btn-clear" id="printBtn">PDF</button>
        <button class="btn-delete" id="clearAllBtn">Hapus</button>
      </div>
    </div>

    
    <div class="table-wrap">
      <table id="txTable" aria-live="polite">
        <thead>
          <tr>
            <th style="width:70px">No</th>
            <th style="width:120px">Tanggal</th>
            <th>Keterangan</th>
            <th class="right">Pemasukan (Rp)</th>
            <th class="right">Pengeluaran (Rp)</th>
            <th class="right">Saldo (Rp)</th>
            <th style="width:110px">Aksi</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- rows injected here -->
        </tbody>
      </table>
    </div>

  </div>

<script>
/*
Simple finance ledger:
- transactions stored in localStorage under key 'transactions'
- each tx: {id, date, desc, type, amount}
- render table with running balance
*/

const dateInput = document.getElementById('date');
const descInput = document.getElementById('desc');
const typeInput = document.getElementById('type');
const amountInput = document.getElementById('amount');
const addBtn = document.getElementById('addBtn');
const clearFormBtn = document.getElementById('clearForm');
const clearAllBtn = document.getElementById('clearAllBtn');
const tbody = document.getElementById('tbody');
const totalIncomeEl = document.getElementById('total-income');
const totalExpenseEl = document.getElementById('total-expense');
const balanceEl = document.getElementById('balance');
const printBtn = document.getElementById('printBtn');

const STORAGE_KEY = 'transactions_v1';

/* utility */
function formatRupiah(num){
  if (isNaN(num)) num = 0;
  const neg = num < 0;
  num = Math.abs(Math.round(num));
  return (neg?'- ':'') + 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function uid() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
}

/* load/save */
function loadTx(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){ return []; }
}
function saveTx(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

/* render */
function render(){
  const tx = loadTx();
  tbody.innerHTML = '';
  let running = 0;
  let totalIncome = 0;
  let totalExpense = 0;

  tx.sort((a,b)=> (a.date > b.date) ? 1 : (a.date < b.date ? -1 : 0)); // sort by date asc

  tx.forEach((t, idx) => {
    const tr = document.createElement('tr');

    const incomeCell = t.type === 'income' ? t.amount : 0;
    const expenseCell = t.type === 'expense' ? t.amount : 0;

    totalIncome += incomeCell;
    totalExpense += expenseCell;

    running += (incomeCell - expenseCell);

    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${t.date || ''}</td>
      <td>${escapeHtml(t.desc || '')}</td>
      <td class="right">${incomeCell ? formatRupiah(incomeCell) : '-'}</td>
      <td class="right">${expenseCell ? formatRupiah(expenseCell) : '-'}</td>
      <td class="right">${formatRupiah(running)}</td>
      <td class="right">
        <div class="actions">
          <button class="btn-delete" data-id="${t.id}">Hapus</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  // tambahkan event listener hanya setelah tabel dirender
  tbody.querySelectorAll(".btn-delete").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-id");
      if(!confirm("Hapus transaksi ini?")) return;
      const newTx = loadTx().filter(t => t.id !== id);
      saveTx(newTx);
      render();
    });
  });

  totalIncomeEl.textContent = formatRupiah(totalIncome);
  totalExpenseEl.textContent = formatRupiah(totalExpense);
  balanceEl.textContent = formatRupiah(totalIncome - totalExpense);
}

/* escape to avoid simple HTML injection in desc */
function escapeHtml(unsafe){
  return (unsafe + '').replace(/[&<"'>]/g, function(m){
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];
  });
}

/* actions */
addBtn.addEventListener('click', function(){
  const date = dateInput.value || new Date().toISOString().slice(0,10);
  const desc = descInput.value.trim();
  const type = typeInput.value;
  const amount = parseInt(amountInput.value) || 0;

  if(!desc){
    alert('Tolong isi keterangan transaksi.');
    return;
  }
  if(amount <= 0){
    alert('Jumlah harus lebih dari 0.');
    return;
  }

  const tx = loadTx();
  tx.push({ id: uid(), date, desc, type, amount });
  saveTx(tx);
  render();
  clearInputs();
});

clearFormBtn.addEventListener('click', clearInputs);
function clearInputs(){
  // set date to today for convenience
  dateInput.value = new Date().toISOString().slice(0,10);
  descInput.value = '';
  typeInput.value = 'income';
  amountInput.value = '';
}

clearAllBtn.addEventListener('click', function(){
  if(confirm('Yakin ingin menghapus semua data transaksi? Tindakan ini tidak bisa dibatalkan.')){
    localStorage.removeItem(STORAGE_KEY);
    render();
  }
});




/* initial setup */
(function init(){
  // set default date if empty
  if(!dateInput.value) dateInput.value = new Date().toISOString().slice(0,10);
  render();
})();
</script>
<!-- Tambahkan jsPDF + AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

<script>
printBtn.addEventListener('click', function(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", "a4");

  const tx = loadTx();
  tx.sort((a,b)=>(a.date > b.date)?1:(a.date < b.date ? -1 : 0));

  let totalIncome = 0, totalExpense = 0, running = 0;
  tx.forEach(t => {
    if(t.type === 'income') totalIncome += t.amount;
    if(t.type === 'expense') totalExpense += t.amount;
  });
  const saldo = totalIncome - totalExpense;

  // === Header ===
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.text("LAPORAN KEUANGAN", 105, 15, {align:"center"});
  doc.setFontSize(11);
  doc.setFont("helvetica", "normal");
  doc.text(`Dicetak: ${new Date().toLocaleDateString("id-ID")}`, 105, 22, {align:"center"});

  // === Kotak Ringkasan ===
  doc.setDrawColor(0);
  doc.setFillColor(245, 245, 245); // abu muda
  doc.roundedRect(14, 30, 182, 25, 3, 3, "F");

  doc.setFontSize(12);
  doc.setFont("helvetica", "bold");
  doc.text("Ringkasan:", 18, 38);
  doc.setFont("helvetica", "normal");
  doc.text(`Total Pemasukan : ${formatRupiah(totalIncome)}`, 18, 45);
  doc.text(`Total Pengeluaran : ${formatRupiah(totalExpense)}`, 85, 45);
  doc.text(`Saldo : ${formatRupiah(saldo)}`, 150, 45);

  // === Tabel Transaksi ===
  const tableData = [];
  running = 0;
  tx.forEach((t,i)=>{
    const income = t.type === 'income' ? t.amount : 0;
    const expense = t.type === 'expense' ? t.amount : 0;
    running += (income - expense);
    tableData.push([
      i+1,
      t.date,
      t.desc,
      income ? formatRupiah(income) : "-",
      expense ? formatRupiah(expense) : "-",
      formatRupiah(running)
    ]);
  });

  if (tableData.length > 0) {
    doc.autoTable({
      startY: 60,
      head: [['No', 'Tanggal', 'Keterangan', 'Pemasukan', 'Pengeluaran', 'Saldo']],
      body: tableData,
      theme: 'grid',
      headStyles: {
        fillColor: [33, 150, 243], // biru
        textColor: 255,
        halign: 'center',
        fontStyle: 'bold'
      },
      bodyStyles: {
        halign: 'center'
      },
      columnStyles: {
        2: { halign: 'left' }, // kolom keterangan rata kiri
        3: { halign: 'right' },
        4: { halign: 'right' },
        5: { halign: 'right' }
      }
    });
  } else {
    doc.setFontSize(12);
    doc.text("Tidak ada data transaksi.", 14, 70);
  }

  // === Footer ===
  const pageHeight = doc.internal.pageSize.height;
  doc.setFontSize(10);
  doc.setTextColor(120);
  doc.text("Laporan keuangan ini dihasilkan otomatis oleh aplikasi.", 105, pageHeight - 10, {align:"center"});

  doc.save('laporan_keuangan.pdf');
});
</script>

</body>
</html>
